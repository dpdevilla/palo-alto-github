{% comment %}
  * Common srcset values

  *  image {object} - The image object (not a url)
  *  widths {Ð°rray} - An array of the image widths for srcset
  *  mobile {boolean} - Set mobile sizes only
  *  desktop {boolean} - Set desktop sizes only

  {% render 'image-srcset', image: image, widths: widths %}
{% endcomment %}

{%- liquid
  assign image_width = image.width | default: image.preview_image.width

  if image_width != blank
    assign widths = widths | default: '180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 1950, 2100, 2260, 2450, 2700, 3000, 3350, 3750, 4100, 4450, 4800, 5150, 5500, 5760' | split: ', '
    assign srcs = ''

    for string_width in widths
      assign width = string_width | times: 1

      if image_width >= width
        if mobile and width >= 1500
          continue
        endif

        capture src
          echo image | image_url: width: width
          echo ' ' | append: width | append: 'w'
        endcapture

        unless srcs == ''
          assign srcs = srcs | append: ', '
        endunless

        assign srcs = srcs | append: src
      endif
    endfor

    echo srcs
  else
    echo image
  endif
-%}
